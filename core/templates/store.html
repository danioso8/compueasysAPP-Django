{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">      
    <link rel="stylesheet" href="{% static 'css/store.css' %}">       
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <title>Tienda Online</title>
</head>
<body>
    <header>
         <nav class="navbar-store" style="background-color: #405cdbff; width: 100%; height: 60px; display: flex; align-items: center; padding: 0 20px; margin-bottom: 50px; margin-top: 30px; justify-content: center;">
                <a href="{% url 'home' %}" class="title" style="color: white; text-decoration: none; font-size: 24px; font-weight: bold; margin-right: 20px;justify-content: start;position: absolute; left: 20px;">
                     CompuEasys
                 </a>
               <a href="{% url 'store' %}" class="nav-link px-3 rounded-pill {% if not request.GET.category %}active bg-light text-primary fw-bold{% else %}text-light{% endif %}">
                Todos
            </a>
               {% for category in categories %}
                <a href="?category={{ category.id }}"
                   class="nav-link px-3 rounded-pill {% if request.GET.category == category.id|stringformat:'s' %}active bg-light text-primary fw-bold{% else %}text-light{% endif %}">
                    {{ category.nombre }}
                </a>
            {% endfor %}
         </nav>
    </header>
    <main>
        <div class="container1">
            <!-- Barra de navegación horizontal de categorías -->
           

            <!-- Contenido principal -->
            <div class="containerP">
                <!-- Barra de búsqueda -->
                <form method="get" class="mb-4">
                    <div class="input-group">
                        <input type="text" name="q" class="form-control" placeholder="Buscar productos..." value="{{ request.GET.q }}">
                        <button class="btn btn-primary" type="submit">
                            <i class="bi bi-search"></i> Buscar
                        </button>
                        <div class="car ms-3">
                            <a href="{% url 'cart' %}" type="button" class="btn position-relative">
                                <i class="bi bi-cart-plus-fill fs-1"></i>
                                <span class="position-absolute top-0 start-70 translate-middle badge rounded-pill bg-danger">
                                    {{ cart_count }}
                                    <span class="visually-hidden">unread messages</span>
                                </span>
                            </a>
                        </div>
                    </div>
                </form>
                      <div class="slug-categoria">
                    {% if current_category %}
                       <h2 class="category-title">
                          Categoría: {{ current_category.nombre }}
                          <span class="badge bg-secondary ms-2">{{ current_category.slug }}</span>

                        </h2>
                    {% else %}
                          <h2 class="category-title">Todos los productos</h2>
                    {% endif %}
                      </div>
                <!-- Lista de productos -->
                <div class="container_product_all">
                    <div class="row_product_all">
                        {% for product in products %}
                            <div class="container_product mb-4">
                                <a href="{% url 'product_detail' product.id %}">
                                    <div class="card_product">
                                        <img src="{{ product.imagen.url }}" alt="{{ product.name }}">
                                    </div>
                                    <div class="cardbody_product">
                                        <h5 class="title">{{ product.name }}</h5>
                                        <div class="description">{{ product.description|truncatechars:30 }}</div>
                                    </div>
                                    <div class="price">${{ product.price|intcomma }} COP</div>
                                </a>
                                <div class="btnAdd mt-2">
                                    <form class="btn" method="post" action="{% url 'add_to_cart' product.id %}">
                                        {% csrf_token %}
                                        <div>
                                            <input type="number" name="quantity" min="1" max="{{ product.stock }}" value="1" class="quantity-input">
                                        </div>
                                        <span class="ui-pdp-buybox__quantity__selected">Disponibles {{ product.stock }}</span>
                                        <div>
                                            <button type="submit" class="add-to-cart-btn">
                                                <i class="bi bi-cart-plus-fill"></i>
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        {% empty %}
                            <p>No hay productos disponibles en este momento.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer>
        {% include 'footer.html' %}
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/store.js' %}"></script>
</body>
</html>