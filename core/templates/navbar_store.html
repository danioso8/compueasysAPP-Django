{% load static %}
<link rel="stylesheet" href="{% static 'css/navbarr.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
  .user-menu-item {
    position: relative;
  }
  
  .user-dropdown {
    position: relative;
  }
  
  .user-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    transition: all 0.3s ease;
  }
  
  .user-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 0.5rem;
  }
  
  .user-btn i.bi-person-circle {
    font-size: 1.5rem;
  }
  
  .user-name {
    font-weight: 500;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  .user-dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-radius: 0.5rem;
    min-width: 200px;
    display: none;
    z-index: 1000;
    margin-top: 0.5rem;
  }
  
  .user-dropdown-menu.show {
    display: block;
  }
  
  .dropdown-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: #333;
    text-decoration: none;
    transition: background 0.2s ease;
  }
  
  .dropdown-item:hover {
    background: #f8f9fa;
  }
  
  .dropdown-item:first-child {
    border-radius: 0.5rem 0.5rem 0 0;
  }
  
  .dropdown-item:last-child {
    border-radius: 0 0 0.5rem 0.5rem;
    border-top: 1px solid #e9ecef;
  }
  
  .login-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 0.5rem;
    transition: all 0.3s ease;
  }
  
  .login-btn:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .user-dropdown-menu {
      position: fixed;
      right: 1rem;
      left: 1rem;
      width: auto;
    }
    
    .user-name {
      display: none;
    }
  }
</style>

<nav class="navbar">

  <a class="name-company" href="{% url 'store' %}">CompuEasys</a>

  <button class="menu-toggle" aria-controls="nav-menu" aria-expanded="false" aria-label="Abrir menú">
    <span class="hamburger" aria-hidden="true">
      <span></span><span></span><span></span>
    </span>
  </button>

  <ul id="nav-menu" class="nav-list">
    <li><a href="{% url 'home' %}">Inicio</a></li>
    <li><a href="{% url 'store' %}">Tienda</a></li>
    <li><a href="{% url 'aboutUs' %}">Sobre Nosotros</a></li>
    <li><a href="{% url 'services' %}">Servicios</a></li>
    <li><a href="{% url 'contactUs' %}">Contactenos</a></li>
    
    {% if is_logged_in %}
    <li class="user-menu-item">
      <div class="user-dropdown">
        <button class="user-btn" id="userMenuBtn">
          <i class="bi bi-person-circle"></i>
          <span class="user-name">{{ user.name|default:user.email }}</span>
          <i class="bi bi-chevron-down"></i>
        </button>
        <div class="user-dropdown-menu" id="userDropdownMenu">
          <a href="{% url 'mis_pedidos' %}" class="dropdown-item">
            <i class="bi bi-box-seam"></i> Mis Pedidos
          </a>
          <a href="{% url 'logout_view' %}" class="dropdown-item">
            <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
          </a>
        </div>
      </div>
    </li>
    {% else %}
    <li><a href="{% url 'login_user' %}" class="login-btn"><i class="bi bi-person"></i> Iniciar Sesión</a></li>
    {% endif %}
  </ul>
  <div class="cart-icon">
  
  </div>
</nav>

<script src="{% static 'js/navbar.js' %}"></script>

<script>
  // Dropdown de usuario
  document.addEventListener('DOMContentLoaded', function() {
    const userMenuBtn = document.getElementById('userMenuBtn');
    const userDropdownMenu = document.getElementById('userDropdownMenu');
    
    if (userMenuBtn && userDropdownMenu) {
      // Toggle dropdown
      userMenuBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        userDropdownMenu.classList.toggle('show');
      });
      
      // Cerrar al hacer click fuera
      document.addEventListener('click', function(e) {
        if (!userMenuBtn.contains(e.target) && !userDropdownMenu.contains(e.target)) {
          userDropdownMenu.classList.remove('show');
        }
      });
      
      // Cerrar al hacer click en un item
      const dropdownItems = userDropdownMenu.querySelectorAll('.dropdown-item');
      dropdownItems.forEach(item => {
        item.addEventListener('click', function() {
          userDropdownMenu.classList.remove('show');
        });
      });
    }
  });
</script>
