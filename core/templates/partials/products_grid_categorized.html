{% load static %}
{% load humanize %}

<!-- Grid de productos agrupados por categorías para carga AJAX -->
{% if products_by_category %}
  {% for category_name, category_products in products_by_category.items %}
    <div class="category-section mb-5">
      <div class="category-header mb-4">
        <h2 class="category-title">
          <i class="bi bi-tag-fill"></i> {{ category_name }}
        </h2>
        <span class="category-count badge bg-primary">
          {{ category_products|length }} producto{{ category_products|length|pluralize }}
        </span>
      </div>
      <div class="products-grid" id="products-grid-{{ forloop.counter }}">
        {% for product in category_products %}
          <article class="product-card" data-product-id="{{ product.id }}">
            <div class="card-image-container">
              <a href="{% url 'product_detail' product.id %}" class="card-image-link">
                {% if product.imagen and product.imagen.name %}
                <img 
                    src="{{ product.imagen.url }}" 
                    alt="{{ product.name }}"
                    class="card-image"
                    loading="lazy"
                >
                {% else %}
                <div class="card-image-placeholder">
                    <i class="bi bi-image"></i>
                    <span>Sin imagen</span>
                </div>
                {% endif %}
              </a>
              
              <!-- Quick Actions -->
              <div class="card-actions">
                  <button class="action-btn favorite-btn" data-product="{{ product.id }}">
                      <i class="bi bi-heart"></i>
                  </button>
                  <button class="action-btn quick-view-btn" data-product="{{ product.id }}">
                      <i class="bi bi-eye"></i>
                  </button>
              </div>
              
              <!-- Stock Badge -->
              {% if product.stock > 0 %}
              <div class="stock-badge in-stock">
                  <i class="bi bi-check-circle"></i>
                 Disponible ({{ product.stock }})
              </div>
              {% else %}
              <div class="stock-badge out-of-stock">
                  <i class="bi bi-x-circle"></i>
                  Agotado
              </div>
              {% endif %}
            </div>
            
            <div class="card-content">
                <div class="card-header">
                    {% if product.category %}
                    <span class="card-category">
                        <i class="bi bi-tag"></i>
                        {{ product.category.nombre }}
                    </span>
                    {% endif %}
                    <h3 class="card-title">
                        <a href="{% url 'product_detail' product.id %}">{{ product.name }}</a>
                    </h3>
                </div>
                
                <div class="card-price">
                    <div class="price-current">
                        ${{ product.price|intcomma }}
                    </div>
                </div>
                
                <div class="card-footer">
                    {% if product.stock > 0 %}
                        <button class="btn-add-cart" 
                                data-product-id="{{ product.id }}"
                                data-product-name="{{ product.name }}"
                                data-product-price="{{ product.price }}">
                            <i class="bi bi-cart-plus"></i>
                            <span>Añadir al carrito</span>
                        </button>
                    {% else %}
                        <button class="btn-notify-stock" 
                                data-product-id="{{ product.id }}"
                                data-product-name="{{ product.name }}">
                            <i class="bi bi-bell"></i>
                            <span>Notificarme</span>
                        </button>
                    {% endif %}
                    <a href="{% url 'product_detail' product.id %}" class="btn-view-details">
                        <i class="bi bi-eye"></i>
                    </a>
                </div>
            </div>
          </article>
        {% endfor %}
      </div>
    </div>
  {% endfor %}
{% else %}
  <div class="no-products">
      <div class="no-products-icon">
          <i class="bi bi-inbox"></i>
      </div>
      <h3>No se encontraron productos</h3>
      <p>Intenta ajustar los filtros de búsqueda</p>
      <button class="btn-clear-filters" id="clear-all-filters">
          <i class="bi bi-arrow-counterclockwise"></i>
          Limpiar filtros
      </button>
  </div>
{% endif %}
