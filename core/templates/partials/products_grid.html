{% load static %}
{% load humanize %}

<!-- Grid de productos para carga AJAX -->
{% if products %}
  {% for product in products %}
    <article class="product-card" data-product-id="{{ product.id }}">
      <div class="card-image-container">
        <a href="{% url 'product_detail' product.id %}" class="card-image-link">
          {% if product.imagen and product.imagen.name %}
          <img 
              src="{{ product.imagen.url }}" 
              alt="{{ product.name }}"
              class="card-image"
              loading="lazy"
          >
          {% else %}
          <div class="card-image-placeholder">
              <i class="bi bi-image"></i>
              <span>Sin imagen</span>
          </div>
          {% endif %}
        </a>
        
        <!-- Quick Actions -->
        <div class="card-actions">
            <button class="action-btn favorite-btn" data-product="{{ product.id }}">
                <i class="bi bi-heart"></i>
            </button>
            <button class="action-btn quick-view-btn" data-product="{{ product.id }}">
                <i class="bi bi-eye"></i>
            </button>
        </div>
        
        <!-- Stock Badge -->
        {% if product.stock > 0 %}
        <div class="stock-badge in-stock">
            <i class="bi bi-check-circle"></i>
           Disponible ({{ product.stock }})
        </div>
        {% else %}
        <div class="stock-badge out-of-stock">
            <i class="bi bi-x-circle"></i>
            Agotado
        </div>
        {% endif %}
      </div>
      
      <div class="card-content">
          <div class="card-header">
              <h3 class="card-title">
                  <a href="{% url 'product_detail' product.id %}">
                      {{ product.name }}
                  </a>
              </h3>
              {% if product.category %}
              <span class="card-category">{{ product.category.nombre }}</span>
              {% endif %}
          </div>
          
          <p class="card-description">
              {{ product.description|truncatechars:80 }}
          </p>
          
          <div class="card-footer">
              <div class="price-section">
                  <span class="price-current">${{ product.price|intcomma }}</span>
                  <span class="price-currency">COP</span>
              </div>
              
              <div class="card-actions-footer">
                  {% if product.stock > 0 %}
                  <form class="add-to-cart-form" data-product="{{ product.id }}">
                      {% csrf_token %}
                      <input type="hidden" name="quantity" value="1">
                      <button type="submit" class="btn-add-cart">
                          <i class="bi bi-cart-plus"></i>
                          <span>Agregar</span>
                      </button>
                  </form>
                  {% else %}
                  <button class="btn-notify-stock" data-product="{{ product.id }}">
                      <i class="bi bi-bell"></i>
                      <span>Notificar</span>
                  </button>
                  {% endif %}
              </div>
          </div>
      </div>
    </article>
  {% endfor %}
{% else %}
  <!-- Estado vacío -->
  <div class="empty-state">
    <div class="empty-icon">
      <i class="bi bi-search"></i>
    </div>
    <h3 class="empty-title">No se encontraron productos</h3>
    <p class="empty-subtitle">
      Intenta ajustar los filtros o la búsqueda para encontrar lo que buscas
    </p>
    <div class="empty-actions">
      <button class="btn-primary" onclick="window.location.reload()">
        <i class="bi bi-arrow-clockwise"></i>
        Mostrar todos
      </button>
    </div>
  </div>
{% endif %}