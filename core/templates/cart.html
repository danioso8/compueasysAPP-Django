{% load static %} {% load humanize %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Carrito de Compras</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    <link rel="stylesheet" href="{% static 'css/cart.css' %}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  </head>
  <body>
    {% include "navbarr.html" %}
    <div class="cart-container">
      <h1 class="cart-title">Carrito de Compras</h1>
      <div class="cart-actions-vaciar">
        <a href="{% url 'clear_cart' %}" class="btn-clear">Vaciar carrito</a>
        <a href="{% url 'checkout' %}" class="btn-pagar">
          Pedir <i class="bi bi-cart-plus-fill fs-1"></i>
        </a>
      </div>
      <div class="cart-table-wrapper">
        <table class="cart-table">
          <thead>
            <tr>
              <th></th>
              <th>Imagen</th>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio unitario</th>
              <th>Subtotal</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for item in cart_items %}
            <tr data-index="{{ forloop.counter0 }}">
              <td>
                <input type="checkbox" class="cart-checkbox" name="selected_products" value="{{ forloop.counter0 }}" checked>
              </td>
              <td>
                {% if item.variant and item.variant.imagen %}
                  <img src="{{ item.variant.imagen.url }}" alt="Variante" style="width: 80px; border-radius: 10%;" />
                {% else %}
                  <img src="{{ item.product.imagen.url }}" alt="Producto" style="width: 80px; border-radius: 10%;" />
                {% endif %}
              </td>
              <td>
                <a href="{% url 'product_detail' item.product.id %}" class="btn-back">
                  {{ item.product.name }}
                </a>
                {% if item.variant %}
                  <br />
                  <span style="color: #0a0a0aff; font-size: 0.9rem;">Color: {{ item.variant.color }}</span>
                  {% if item.variant.talla %}
                    <br /><span style="color: #0c0c0cff; font-size: 0.7rem;">Talla: {{ item.variant.talla }}</span>
                  {% endif %}
                {% endif %}
              </td>
              <td>
                <form method="post" data-product="{{ item.product.id }}" data-variant="{% if item.variant %}{{ item.variant.id }}{% endif %}" class="cart-qty-form">
                  {% csrf_token %}
                  <button type="button" name="action" value="decrease" class="btn-qty decrease">-</button>
                  <input type="number" min="1" max="{% if item.variant %}{{ item.variant.stock }}{% else %}{{ item.product.stock }}{% endif %}" class="cart-qty" value="{{ item.quantity }}" style="width: 40px; text-align: center;" />
                  <button type="button" name="action" value="increase" class="btn-qty increase">+</button>
                  <input type="hidden" name="variant_id" value="{% if item.variant %}{{ item.variant.id }}{% endif %}">
                </form>
              </td>
              <td>
                {% if item.variant %}
                  ${{ item.variant.precio|intcomma }}
                {% else %}
                  ${{ item.product.price|intcomma }}
                {% endif %}
              </td>
              <td class="item-subtotal">
                ${{ item.subtotal|intcomma }}
              </td>
              <td>
                <a href="{% url 'remove_from_cart' item.product.id %}{% if item.variant %}?variant_id={{ item.variant.id }}{% endif %}" class="btn-remove"><i class="fa-solid fa-trash-can"></i></a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" class="cart-empty">
                No hay productos en tu carrito.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="cart-actions">
        <a href="{% url 'store' %}" class="btn-back">&larr; Seguir comprando</a>
      </div>
        <p>
          Cantidad de productos:
          <span class="cart-count">{{ cart_count }}</span>
        </p>
        <div class="cart-ordernote">
          <span class="cart-ordernote-heading">
            Ingrese una nota de regalo o instrucciones especiales de entrega a continuación:
          </span>
          <div class="form-field">
            <textarea class="form-field-input form-field-textarea" name="note" id="cart-note" placeholder="Ingrese su nota aquí..."></textarea>
            <label class="form-field-title" for="cart-note">Instrucciones especiales</label>
          </div>
        </div>
      </div>
      <hr />
      <div class="cart-summary">
        <p>Total a pagar</p>
        <h1 class="cart-total" id="cart-total">${{ cart_total|intcomma }}</h1>
      </div>
      <div class="btn-pagar2">
        <a href="#" id="finalizar-pedido">Finalizar Pedido</a>
      </div>
      
    </div>
    {% include "footer.html" %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/cart.js' %}"></script>
  </body>
</html>