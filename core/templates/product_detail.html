{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=3.0">
    <title>{{ product.name }} - CompuEasys</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}?v=1.1">
    <link rel="stylesheet" href="{% static 'css/detail.css' %}?v=1.1">
    <link rel="stylesheet" href="{% static 'css/detail_modern.css' %}?v=1.2">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Precargar im√°genes importantes -->
    <link rel="preload" href="{% if product.imagen %}{{ product.imagen.url }}{% endif %}" as="image">
    
    <!-- Meta tags para redes sociales -->
    <meta property="og:title" content="{{ product.name }}">
    <meta property="og:description" content="{{ product.description|truncatechars:150 }}">
    <meta property="og:image" content="{% if product.imagen %}{{ product.imagen.url }}{% endif %}">
    <meta name="description" content="{{ product.description|truncatechars:150 }}">
    
    <style>
        /* Modern Product Detail Styles - Inline for Performance */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --danger-gradient: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.16);
            --shadow-xl: 0 12px 48px rgba(0,0,0,0.2);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --transition-fast: all 0.2s ease;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .modern-breadcrumb {
            background: white;
            padding: 15px 0;
            box-shadow: var(--shadow-sm);
            margin-bottom: 30px;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: "‚Üí";
            color: #667eea;
        }
        
        .product-detail-container {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .badge-stock {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .badge-stock.in-stock {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        .badge-stock.low-stock {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        
        .badge-stock.out-stock {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            color: white;
        }
    </style>
</head>
<body>
    <!-- WhatsApp Floating Button - Modern (abajo a la derecha) -->
    <a href="#" id="whatsapp-chat-float" class="whatsapp-float-modern" title="Chatea por WhatsApp" target="_blank" style="position: fixed !important; right: 30px !important; bottom: 30px !important; z-index: 9998 !important; width: 60px !important; height: 60px !important; display: flex !important; align-items: center !important; justify-content: center !important; border-radius: 50% !important; background: linear-gradient(135deg, #25d366 0%, #128c7e 100%) !important; color: white !important; font-size: 28px !important; box-shadow: 0 8px 32px rgba(0,0,0,0.16) !important;">
         <i class="fab fa-whatsapp"></i>
    </a>
    
    <!-- Floating Cart Button - Modern (arriba a la derecha) -->
    <button class="cart-float-modern cart-float-top" title="Ver carrito" onclick="toggleCartSidebar()" style="position: fixed !important; right: 30px !important; top: 20px !important; z-index: 9998 !important; width: 65px !important; height: 65px !important; display: flex !important; align-items: center !important; justify-content: center !important; border-radius: 50% !important; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; color: white !important; font-size: 30px !important; border: none !important; cursor: pointer !important; box-shadow: 0 8px 32px rgba(0,0,0,0.16) !important; transition: all 0.3s ease !important;">
        <i class="bi bi-cart-plus-fill"></i>
        {% if cart_count > 0 %}
        <span id="cart-badge-float" class="badge rounded-pill bg-danger pulse-animation" style="position: absolute !important; top: -5px !important; right: -5px !important; z-index: 9999 !important; font-size: 13px !important; font-weight: 700 !important; padding: 5px 8px !important; min-width: 24px !important;">
            {{ cart_count }}
        </span>
        {% endif %}
    </button>
    
    <!-- Cart Sidebar Modern -->
    <div id="cart-sidebar-modern" class="cart-sidebar-modern">
        <div class="cart-sidebar-header">
            <h3>
                <i class="bi bi-cart3 me-2"></i>
                Mi Carrito
                <span id="cart-count-sidebar" class="cart-count-badge">{{ cart_count }}</span>
            </h3>
            <button class="cart-close-btn" onclick="toggleCartSidebar()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        
        <div class="cart-sidebar-content">
            {% if cart_count > 0 %}
                <!-- Items del carrito con productos reales -->
                <div id="cart-items-container" class="cart-items-list">
                    {% for item in cart_items %}
                    <div class="cart-item-card">
                        <div class="cart-item-image">
                            {% if item.variant and item.variant.imagen %}
                                <img src="{{ item.variant.imagen.url }}" alt="{{ item.product.name }}">
                            {% elif item.product.imagen %}
                                <img src="{{ item.product.imagen.url }}" alt="{{ item.product.name }}">
                            {% else %}
                                <div class="cart-item-no-image">
                                    <i class="bi bi-image"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="cart-item-details">
                            <h4 class="cart-item-name">{{ item.product.name|truncatechars:35 }}</h4>
                            {% if item.variant %}
                            <p class="cart-item-variant">
                                <i class="bi bi-palette me-1"></i>{{ item.variant.color }}
                            </p>
                            {% endif %}
                            <div class="cart-item-quantity">
                                <span class="quantity-label">Cantidad:</span>
                                <span class="quantity-value">{{ item.quantity }}</span>
                            </div>
                            <div class="cart-item-price">
                                <span class="price-label">Precio:</span>
                                <span class="price-value">${{ item.price|floatformat:0|intcomma }}</span>
                            </div>
                            <div class="cart-item-subtotal">
                                <span class="subtotal-label">Subtotal:</span>
                                <span class="subtotal-value">${{ item.subtotal|floatformat:0|intcomma }} COP</span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="cart-empty-state">
                    <i class="bi bi-cart-x"></i>
                    <h4>Tu carrito est√° vac√≠o</h4>
                    <p>Agrega productos para empezar a comprar</p>
                    <a href="/store" class="btn-continue-shopping">
                        <i class="bi bi-shop me-2"></i>Ir a la tienda
                    </a>
                </div>
            {% endif %}
        </div>
        
        {% if cart_count > 0 %}
        <div class="cart-sidebar-footer">
            <div class="cart-total-section">
                <span class="cart-total-label">Total:</span>
                <span id="cart-total-amount" class="cart-total-amount">${{ cart_total|floatformat:0|intcomma }} COP</span>
            </div>
            <div class="cart-actions">
                <a href="/cart" class="btn-view-cart">
                    <i class="bi bi-eye me-2"></i>Ver carrito completo
                </a>
                <a href="/checkout" class="btn-checkout-now">
                    <i class="bi bi-lightning-charge-fill me-2"></i>Finalizar compra
                </a>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Overlay para cerrar el sidebar -->
    <div id="cart-sidebar-overlay" class="cart-sidebar-overlay" onclick="toggleCartSidebar()"></div>
    
    <header>
        {% include 'navbarr.html' %}
    </header>
    
    <!-- Modern Breadcrumb -->
    <nav class="modern-breadcrumb" aria-label="breadcrumb">
        <div class="container">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/store"><i class="bi bi-house-door me-1"></i>Inicio</a></li>
                {% if product.category %}
                <li class="breadcrumb-item"><a href="/?category={{ product.category.id }}">{{ product.category.nombre }}</a></li>
                {% endif %}
                <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
            </ol>
        </div>
    </nav>
    
    <main>
        <div class="container-product-all product-detail-container">
            <div class="container_product">
                
                <div class="product-Galery row g-4">
                    <!-- Secci√≥n de imagen principal y galer√≠a - Lado Izquierdo -->
                    <div class="col-lg-6">
                        <div class="product-image-section">
                            <!-- Slider de imagen principal con controles modernos -->
                            <div class="image-slider-modern">
                                <!-- Badges de Producto -->
                                <div class="product-badges">
                                    {% if product.descuento > 0 %}
                                    <span class="badge-discount">
                                        <i class="bi bi-percent me-1"></i>-{{ product.descuento }}%
                                    </span>
                                    {% endif %}
                                    {% if product.stock <= 10 and product.stock > 0 %}
                                    <span class="badge-low-stock">
                                        <i class="bi bi-exclamation-triangle me-1"></i>¬°√öltimas unidades!
                                    </span>
                                    {% elif product.stock == 0 %}
                                    <span class="badge-out-stock">
                                        <i class="bi bi-x-circle me-1"></i>Agotado
                                    </span>
                                    {% endif %}
                                </div>
                                
                                <div class="main-image-container" onclick="openFullscreenGallery()" style="cursor: pointer;">
                                    <img id="main-product-image"
                                         src="{% if Galeria_images %}{{ Galeria_images.0.galeria.url }}{% else %}{{ product.imagen.url }}{% endif %}"
                                         alt="{{ product.name }}"
                                         loading="lazy"
                                         class="product-main-image"
                                         title="Haz clic para ver en pantalla completa">                                   
                                    
                                </div>
                                
                                {% if Galeria_images|length > 1 %}
                                <button id="prev-img" class="slider-arrow-modern prev" aria-label="Imagen anterior">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <button id="next-img" class="slider-arrow-modern next" aria-label="Imagen siguiente">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                                
                                <!-- Indicadores de slide -->
                                <div class="slide-indicators">
                                    {% for imagen in Galeria_images %}
                                    <span class="indicator {% if forloop.first %}active{% endif %}" data-index="{{ forloop.counter0 }}"></span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Galer√≠a de thumbnails moderna -->
                            {% if Galeria_images %}
                            <div class="gallery-thumbnails">
                                {% for imagen in Galeria_images %}
                                    <div class="thumbnail-wrapper {% if forloop.first %}active{% endif %}" data-index="{{ forloop.counter0 }}">
                                        <img src="{{ imagen.galeria.url }}" 
                                             alt="Vista {{ forloop.counter }} de {{ product.name }}" 
                                             class="thumbnail-image"
                                             loading="lazy">
                                    </div>
                                {% endfor %}
                            </div>
                            {% endif %}

                        <!-- Caracter√≠sticas del producto mejoradas -->
                        <div class="product-details">
                            <div class="cart-left">
                                <h2>Caracter√≠sticas del Producto</h2>
                                <div class="product-specs">
                                    <div class="spec-item">
                                        <span class="spec-label">Producto:</span>
                                        <span class="spec-value text-success">{{ product.name }}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Descripci√≥n:</span>
                                        <span class="spec-value">{{ product.description|default:"Sin descripci√≥n disponible" }}</span>
                                    </div>
                                    {% if product.category %}
                                    <div class="spec-item">
                                        <span class="spec-label">Categor√≠a:</span>
                                        <span class="spec-value text-primary">{{ product.category.nombre }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Rese√±as de clientes mejoradas -->
                        <div class="product-reviews">
                            <h2>Rese√±as de Clientes</h2>
                            <div class="reviews-container">
                                <div class="review">
                                    <div class="review-header">
                                        <strong class="reviewer-name">Juan P√©rez</strong>
                                        <div class="rating">
                                            <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                            <span class="rating-text">5.0</span>
                                        </div>
                                    </div>
                                    <p class="review-text">Excelente producto, muy satisfecho con la compra. La calidad supera mis expectativas.</p>
                                    <div class="review-date">Hace 2 d√≠as</div>
                                </div>
                                <div class="review">
                                    <div class="review-header">
                                        <strong class="reviewer-name">Mar√≠a G√≥mez</strong>
                                        <div class="rating">
                                            <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                                            <span class="rating-text">4.0</span>
                                        </div>
                                    </div>
                                    <p class="review-text">Buena calidad, aunque el env√≠o tard√≥ un poco m√°s de lo esperado. En general, recomendable.</p>
                                    <div class="review-date">Hace 1 semana</div>
                                </div>
                                <div class="review">
                                    <div class="review-header">
                                        <strong class="reviewer-name">Carlos Rodr√≠guez</strong>
                                        <div class="rating">
                                            <span class="stars">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span>
                                            <span class="rating-text">3.0</span>
                                        </div>
                                    </div>
                                    <p class="review-text">El producto es aceptable, pero esperaba m√°s por el precio. Podr√≠a mejorar algunos aspectos.</p>
                                    <div class="review-date">Hace 2 semanas</div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- Informaci√≥n y acciones de compra - Lado Derecho -->
                    <div class="col-lg-6">
                        <div class="product-info-modern">
                            <!-- Header del Producto -->
                            <div class="product-header">
                                {% if product.category %}
                                <div class="product-category">
                                    <i class="bi bi-tag-fill me-1"></i>{{ product.category.nombre }}
                                </div>
                                {% endif %}
                                
                                <h1 class="product-title">{{ product.name }}</h1>
                                
                                <!-- Rating y Reviews -->
                                <div class="product-rating">
                                    <div class="stars">
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-half text-warning"></i>
                                        <span class="rating-value ms-2">4.5</span>
                                    </div>
                                    <span class="reviews-count">({{ product.stock|add:"15" }} rese√±as)</span>
                                </div>
                            </div>
                            
                            <!-- Descripci√≥n del Producto -->
                            <div class="product-description">
                                <p>{{ product.description|default:"Producto de alta calidad con excelentes caracter√≠sticas y rendimiento."|safe }}</p>
                            </div>
                            
                            <!-- Precio Destacado Moderno -->
                            <div class="price-section-modern">
                                <div class="price-wrapper">
                                    <span class="price-label">Precio</span>
                                    <div class="price-main">
                                        <span id="main-product-price" class="price-amount">${{ product.price|intcomma }}</span>
                                        <span class="price-currency">COP</span>
                                    </div>
                                    {% if product.descuento > 0 %}
                                    <div class="price-old">
                                        <span class="text-decoration-line-through">${{ product.price|add:"30000"|intcomma }} COP</span>
                                        <span class="badge bg-danger ms-2">-{{ product.descuento }}% OFF</span>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Stock Indicator -->
                                <div class="stock-indicator-modern">
                                    {% if product.stock > 10 %}
                                        <span class="badge-stock in-stock">
                                            <i class="bi bi-check-circle-fill me-1"></i>
                                            <span id="available-stock">{{ product.stock }} disponibles</span>
                                        </span>
                                    {% elif product.stock > 0 %}
                                        <span class="badge-stock low-stock">
                                            <i class="bi bi-exclamation-triangle-fill me-1"></i>
                                            <span id="available-stock">¬°Solo {{ product.stock }} disponibles!</span>
                                        </span>
                                    {% else %}
                                        <span class="badge-stock out-stock">
                                            <i class="bi bi-x-circle-fill me-1"></i>
                                            Agotado
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Formulario de Compra Moderno -->
                            <div class="purchase-section-modern">
                                <form class="purchase-form-modern" method="post" action="{% url 'add_to_cart_detail' product.id %}">
                                    {% csrf_token %}
                                    
                                    <!-- Selector de variantes moderno -->
                                    {% if product.variants.all %}
                                    <div class="variants-section-modern">
                                        <label class="section-label">
                                            <i class="bi bi-palette me-2"></i>Selecciona tu variante
                                        </label>
                                        <div id="variant-swatches" class="variant-grid-modern">
                                            {% for variant in product.variants.all %}
                                            <div class="variant-card-modern {% if variant.stock == 0 %}out-of-stock{% endif %}" 
                                                 data-variant-id="{{ variant.id }}"
                                                 data-color="{{ variant.color }}"
                                                 data-price="{{ variant.precio }}"
                                                 data-stock="{{ variant.stock }}"
                                                 {% if variant.imagen %}data-img="{{ variant.imagen.url }}"{% endif %}
                                                 title="{{ variant.color|default:'Variante' }} - {{ variant.stock }} disponibles">
                                                
                                                {% if variant.imagen %}
                                                    <!-- Variante con imagen -->
                                                    <div class="variant-image-wrapper">
                                                        <img src="{{ variant.imagen.url }}" 
                                                             alt="{{ variant.color }}" 
                                                             class="variant-img"
                                                             loading="lazy">
                                                        <div class="variant-check-icon">
                                                            <i class="bi bi-check-lg"></i>
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <!-- Variante solo color -->
                                                    <div class="variant-color-swatch" style="background-color: {{ variant.color|default:'#e0e0e0' }}">
                                                        <div class="variant-check-icon">
                                                            <i class="bi bi-check-lg"></i>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                
                                                <div class="variant-details">
                                                    <span class="variant-name">{{ variant.color|default:'Color' }}</span>
                                                    <span class="variant-stock-badge">
                                                        {% if variant.stock > 0 %}
                                                            <i class="bi bi-check-circle-fill text-success"></i> {{ variant.stock }}
                                                        {% else %}
                                                            <i class="bi bi-x-circle-fill text-danger"></i> Agotado
                                                        {% endif %}
                                                    </span>
                                                    {% if variant.precio %}
                                                    <span class="variant-price-tag">${{ variant.precio|floatformat:0 }}</span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <input type="hidden" name="variant_id" id="variant_id" required>
                                        
                                        <!-- Variante seleccionada - Info moderna -->
                                        <div id="selected-variant-info" class="selected-variant-modern" style="display: none;">
                                            <div class="selected-content">
                                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                <span>Seleccionado: <strong id="variant-selected-name"></strong></span>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                
                             
                        </div>
                        
                                    <!-- Controles de cantidad modernos -->
                                    {% if product.stock > 0 %}
                                    <div class="quantity-section-modern">
                                        <label class="section-label">
                                            <i class="bi bi-123 me-2"></i>Cantidad
                                        </label>
                                        <div class="quantity-control-modern">
                                            <button type="button" class="qty-btn qty-decrease" aria-label="Disminuir">
                                                <i class="bi bi-dash-lg"></i>
                                            </button>
                                            <input type="number" 
                                                   name="quantity" 
                                                   min="1" 
                                                   value="1" 
                                                   max="{{ product.stock }}" 
                                                   class="qty-input"
                                                   aria-label="Cantidad">
                                            <button type="button" class="qty-btn qty-increase" aria-label="Aumentar">
                                                <i class="bi bi-plus-lg"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Botones de acci√≥n modernos -->
                                    <div class="action-buttons-modern">
                                        <button type="submit" id="add_to_cart" class="btn-add-cart-modern">
                                            <span class="btn-icon">
                                                <i class="bi bi-cart-plus-fill"></i>
                                            </span>
                                            <span class="btn-text">Agregar al Carrito</span>
                                            <span class="btn-shimmer"></span>
                                        </button>
                                        
                                        <button type="button" class="btn-buy-now-modern" id="buy-now-btn">
                                            <span class="btn-icon">
                                                <i class="bi bi-lightning-charge-fill"></i>
                                            </span>
                                            <span class="btn-text">Comprar Ahora</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Acciones secundarias -->
                                    <div class="secondary-actions-modern">
                                        <button type="button" class="btn-wishlist" title="Agregar a favoritos">
                                            <i class="bi bi-heart"></i>
                                            <span>Favoritos</span>
                                        </button>
                                        <button type="button" class="btn-share" title="Compartir producto" onclick="shareProduct()">
                                            <i class="bi bi-share"></i>
                                            <span>Compartir</span>
                                        </button>
                                    </div>
                                    
                                    {% else %}
                                    <!-- Estado agotado moderno -->
                                    <div class="out-of-stock-modern">
                                        <div class="alert alert-danger d-flex align-items-center mb-3">
                                            <i class="bi bi-exclamation-triangle-fill me-3 fs-3"></i>
                                            <div>
                                                <h5 class="mb-1">Producto Agotado</h5>
                                                <p class="mb-0 small">Este producto no est√° disponible actualmente.</p>
                                            </div>
                                        </div>
                                        <button type="button" class="btn-notify-modern" onclick="alert('‚úÖ Te notificaremos cuando est√© disponible')">
                                            <i class="bi bi-bell-fill me-2"></i>
                                            Notificarme cuando est√© disponible
                                        </button>
                                    </div>
                                    {% endif %}
                                </form>
                                
                                <!-- Pol√≠ticas de compra modernas -->
                                <div class="policies-section-modern">
                                    <h3 class="policies-title">
                                        <i class="bi bi-info-circle me-2"></i>Informaci√≥n de Compra
                                    </h3>
                                    <div class="policies-grid-modern">
                                        <div class="policy-card">
                                            <div class="policy-icon policy-shipping">
                                                <i class="bi bi-truck"></i>
                                            </div>
                                            <div class="policy-content">
                                                <h4>Env√≠o Gratis</h4>
                                                <p>En compras superiores a $200,000</p>
                                            </div>
                                        </div>
                                        <div class="policy-card">
                                            <div class="policy-icon policy-warranty">
                                                <i class="bi bi-shield-check"></i>
                                            </div>
                                            <div class="policy-content">
                                                <h4>Garant√≠a</h4>
                                                <p>30 d√≠as por defectos de f√°brica</p>
                                            </div>
                                        </div>
                                        <div class="policy-card">
                                            <div class="policy-icon policy-return">
                                                <i class="bi bi-arrow-left-right"></i>
                                            </div>
                                            <div class="policy-content">
                                                <h4>Devoluciones</h4>
                                                <p>Devoluciones gratuitas en 15 d√≠as</p>
                                            </div>
                                        </div>
                                        <div class="policy-card">
                                            <div class="policy-icon policy-payment">
                                                <i class="bi bi-credit-card"></i>
                                            </div>
                                            <div class="policy-content">
                                                <h4>Pago Seguro</h4>
                                                <p>M√©todos de pago seguros</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>
                                <li><strong>Devoluciones:</strong> Aceptamos devoluciones dentro de los 30 d√≠as posteriores a la compra. El producto debe estar en su estado original.</li>
                                <li><strong>Garant√≠a:</strong> Todos nuestros productos cuentan con una garant√≠a de 3 meses contra defectos de fabricaci√≥n.</li>
                                <li><strong>Soporte:</strong> Nuestro equipo de soporte est√° disponible para ayudarte con cualquier consulta o problema relacionado con tu compra.</li>
                            </ul>
                        </div>
                    </div>
                </div>
              
            </div>
            
             
        </div>
        
        <!-- Productos Relacionados Modernos con Slider -->
        {% if related_products %}
        <section class="related-products-section">
            <div class="container">
                <div class="section-header-modern">
                    <div class="section-title-wrapper">
                        <h2 class="section-title-modern">
                            <i class="bi bi-stars me-2"></i>
                            {% if product.category %}
                            M√°s productos de {{ product.category.nombre }}
                            {% else %}
                            Productos que te pueden interesar
                            {% endif %}
                        </h2>
                        <p class="section-subtitle">
                            {% if product.category %}
                            Explora m√°s opciones similares a "{{ product.name|truncatechars:50 }}"
                            {% else %}
                            Descubre productos relacionados
                            {% endif %}
                        </p>
                    </div>
                    <div class="slider-controls-detail">
                        <button class="slider-btn-detail slider-prev-detail" id="detailSliderPrev">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <button class="slider-btn-detail slider-next-detail" id="detailSliderNext">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                        <a href="/store" class="btn-view-all-modern ms-3">
                            <span>Ver todos</span>
                            <i class="bi bi-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
                
                <div class="related-slider-wrapper-detail">
                    <div class="related-products-grid" id="detailRelatedSlider">
                    {% for related in related_products %}
                    <div class="product-card-modern">
                        <a href="{% url 'product_detail' related.id %}" class="product-card-link">
                            <!-- Imagen del producto -->
                            <div class="product-image-wrapper">
                                {% if related.imagen %}
                                <img src="{{ related.imagen.url }}" 
                                     alt="{{ related.name }}" 
                                     class="product-image"
                                     loading="lazy">
                                {% else %}
                                <div class="product-image-placeholder">
                                    <i class="bi bi-image"></i>
                                </div>
                                {% endif %}
                                
                                <!-- Badges -->
                                <div class="product-badges-mini">
                                    {% if related.descuento > 0 %}
                                    <span class="badge-mini badge-discount">-{{ related.descuento }}%</span>
                                    {% endif %}
                                    {% if related.stock <= 5 and related.stock > 0 %}
                                    <span class="badge-mini badge-low">¬°Pocas!</span>
                                    {% elif related.stock == 0 %}
                                    <span class="badge-mini badge-out">Agotado</span>
                                    {% endif %}
                                </div>
                                
                                <!-- Quick Actions -->
                                <div class="product-quick-actions">
                                    <button class="quick-action-btn" title="Vista r√°pida" onclick="event.preventDefault(); alert('üîç Vista r√°pida - Pr√≥ximamente')">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="quick-action-btn" title="Agregar a favoritos" onclick="event.preventDefault(); alert('‚ù§Ô∏è Agregado a favoritos')">
                                        <i class="bi bi-heart"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Informaci√≥n del producto -->
                            <div class="product-info-mini">
                                {% if related.category %}
                                <span class="product-category-mini">
                                    <i class="bi bi-tag-fill me-1"></i>{{ related.category.nombre }}
                                </span>
                                {% endif %}
                                
                                <h3 class="product-name-mini">{{ related.name|truncatechars:50 }}</h3>
                                
                                <!-- Rating -->
                                <div class="product-rating-mini">
                                    <div class="stars-mini">
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-half"></i>
                                    </div>
                                    <span class="rating-count">({{ related.stock|add:"8" }})</span>
                                </div>
                                
                                <!-- Precio -->
                                <div class="product-price-mini">
                                    <span class="price-current">${{ related.price|intcomma }}</span>
                                    {% if related.descuento > 0 %}
                                    <span class="price-old">${{ related.price|add:"15000"|intcomma }}</span>
                                    {% endif %}
                                </div>
                                
                                <!-- Stock indicator -->
                                <div class="stock-mini">
                                    {% if related.stock > 10 %}
                                    <span class="stock-badge stock-available">
                                        <i class="bi bi-check-circle-fill"></i> Disponible
                                    </span>
                                    {% elif related.stock > 0 %}
                                    <span class="stock-badge stock-low">
                                        <i class="bi bi-exclamation-circle-fill"></i> ¬°Solo {{ related.stock }}!
                                    </span>
                                    {% else %}
                                    <span class="stock-badge stock-out">
                                        <i class="bi bi-x-circle-fill"></i> Agotado
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Bot√≥n de acci√≥n -->
                            <div class="product-action-mini">
                                {% if related.stock > 0 %}
                                <button class="btn-add-mini" onclick="event.preventDefault(); addToCartQuick({{ related.id }}, '{{ related.name }}')">
                                    <i class="bi bi-cart-plus me-2"></i>
                                    <span>Agregar</span>
                                </button>
                                {% else %}
                                <button class="btn-add-mini disabled" disabled>
                                    <i class="bi bi-x-circle me-2"></i>
                                    <span>Agotado</span>
                                </button>
                                {% endif %}
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                </div>
                
                <!-- Indicadores del slider -->
                <div class="slider-dots-detail" id="detailSliderDots"></div>
            </div>
        </section>
        {% endif %}
    </main>
   
   
   
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/detail_product.js' %}"></script>
    
    <!-- Modern Product Detail Scripts -->
    <script>
    // Utility Functions
    function shareProduct() {
        if (navigator.share) {
            navigator.share({
                title: '{{ product.name }}',
                text: '{{ product.description|truncatechars:100 }}',
                url: window.location.href
            }).then(() => {
                console.log('Producto compartido exitosamente');
            }).catch((error) => {
                console.log('Error al compartir:', error);
                fallbackShare();
            });
        } else {
            fallbackShare();
        }
    }
    
    function fallbackShare() {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            alert('‚úÖ Enlace copiado al portapapeles');
        });
    }
    
    let fullscreenCurrentIndex = 0;
    
    function openFullscreenGallery() {
        const galleryImages = [
            {% for imagen in Galeria_images %}
                "{{ imagen.galeria.url }}",
            {% endfor %}
        ];
        
        {% if not Galeria_images %}
            galleryImages.push("{{ product.imagen.url }}");
        {% endif %}
        
        // Obtener √≠ndice actual de la imagen mostrada
        const mainImg = document.getElementById('main-product-image');
        const currentSrc = mainImg.src;
        fullscreenCurrentIndex = galleryImages.findIndex(img => currentSrc.includes(img.split('/').pop()));
        if (fullscreenCurrentIndex === -1) fullscreenCurrentIndex = 0;
        
        const overlay = document.createElement('div');
        overlay.className = 'fullscreen-overlay';
        overlay.id = 'fullscreen-gallery-overlay';
        
        overlay.innerHTML = `
            <div class="fullscreen-content">
                <button class="fullscreen-close" onclick="closeFullscreenGallery()">
                    <i class="bi bi-x-lg"></i>
                </button>
                
                ${galleryImages.length > 1 ? `
                <button class="fullscreen-nav fullscreen-prev" onclick="changeFullscreenImage(-1)">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="fullscreen-nav fullscreen-next" onclick="changeFullscreenImage(1)">
                    <i class="bi bi-chevron-right"></i>
                </button>
                ` : ''}
                
                <img id="fullscreen-image" src="${galleryImages[fullscreenCurrentIndex]}" alt="{{ product.name }}" class="fullscreen-image">
                
                ${galleryImages.length > 1 ? `
                <div class="fullscreen-counter">
                    <span id="current-image-num">${fullscreenCurrentIndex + 1}</span> / ${galleryImages.length}
                </div>
                ` : ''}
            </div>
        `;
        
        document.body.appendChild(overlay);
        document.body.style.overflow = 'hidden';
        
        // Close on click outside
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
                closeFullscreenGallery();
            }
        });
        
        // Close on ESC key
        document.addEventListener('keydown', handleFullscreenKeyboard);
    }
    
    function closeFullscreenGallery() {
        const overlay = document.getElementById('fullscreen-gallery-overlay');
        if (overlay) {
            overlay.remove();
            document.body.style.overflow = '';
            document.removeEventListener('keydown', handleFullscreenKeyboard);
        }
    }
    
    function changeFullscreenImage(direction) {
        const galleryImages = [
            {% for imagen in Galeria_images %}
                "{{ imagen.galeria.url }}",
            {% endfor %}
        ];
        
        {% if not Galeria_images %}
            galleryImages.push("{{ product.imagen.url }}");
        {% endif %}
        
        fullscreenCurrentIndex += direction;
        
        if (fullscreenCurrentIndex < 0) {
            fullscreenCurrentIndex = galleryImages.length - 1;
        } else if (fullscreenCurrentIndex >= galleryImages.length) {
            fullscreenCurrentIndex = 0;
        }
        
        const fullscreenImg = document.getElementById('fullscreen-image');
        const counterNum = document.getElementById('current-image-num');
        
        if (fullscreenImg) {
            fullscreenImg.style.opacity = '0';
            setTimeout(() => {
                fullscreenImg.src = galleryImages[fullscreenCurrentIndex];
                fullscreenImg.style.opacity = '1';
                if (counterNum) {
                    counterNum.textContent = fullscreenCurrentIndex + 1;
                }
            }, 200);
        }
    }
    
    function handleFullscreenKeyboard(e) {
        if (e.key === 'Escape') {
            closeFullscreenGallery();
        } else if (e.key === 'ArrowLeft') {
            changeFullscreenImage(-1);
        } else if (e.key === 'ArrowRight') {
            changeFullscreenImage(1);
        }
    }
    
    // Add fullscreen overlay styles
    const style = document.createElement('style');
    style.textContent = `
        .zoom-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }
        .main-image-container:hover .zoom-hint {
            opacity: 1;
        }
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.97);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        .fullscreen-content {
            position: relative;
            width: 90%;
            height: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .fullscreen-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            transition: opacity 0.3s ease;
        }
        .fullscreen-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .fullscreen-close:hover {
            transform: scale(1.1) rotate(90deg);
            background: #f5576c;
            color: white;
        }
        .fullscreen-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }
        .fullscreen-nav:hover {
            background: white;
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        .fullscreen-prev {
            left: 30px;
        }
        .fullscreen-next {
            right: 30px;
        }
        .fullscreen-counter {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            z-index: 10001;
            backdrop-filter: blur(10px);
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @media (max-width: 768px) {
            .fullscreen-nav {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
            .fullscreen-prev {
                left: 15px;
            }
            .fullscreen-next {
                right: 15px;
            }
            .fullscreen-close {
                width: 45px;
                height: 45px;
                font-size: 20px;
                top: 15px;
                right: 15px;
            }
        }
    `;
    document.head.appendChild(style);
    </script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
    console.log('üé® Inicializando producto moderno...');
    
    // ===== GALER√çA DE IM√ÅGENES MODERNA =====
    const galleryImages = [
        {% for imagen in Galeria_images %}
            "{{ imagen.galeria.url }}",
        {% endfor %}
    ];
    
    {% if not Galeria_images %}
        galleryImages.push("{{ product.imagen.url }}");
    {% endif %}

    console.log('üì∏ Im√°genes en galer√≠a:', galleryImages.length);
    
    let currentIndex = 0;
    const mainImg = document.getElementById('main-product-image');
    const prevBtn = document.getElementById('prev-img');
    const nextBtn = document.getElementById('next-img');
    const indicators = document.querySelectorAll('.indicator');
    const thumbnails = document.querySelectorAll('.thumbnail-wrapper');
    
    console.log('üîç Elementos encontrados:', {
        mainImg: !!mainImg,
        prevBtn: !!prevBtn,
        nextBtn: !!nextBtn,
        indicators: indicators.length,
        thumbnails: thumbnails.length
    });
    
    // Agregar transici√≥n a la imagen principal
    if (mainImg) {
        mainImg.style.transition = 'opacity 0.3s ease';
    }

    function showImage(index) {
        if (galleryImages.length === 0 || !mainImg) {
            console.warn('‚ö†Ô∏è No hay im√°genes o elemento mainImg no encontrado');
            return;
        }
        
        // Validar √≠ndice
        if (index < 0) index = galleryImages.length - 1;
        if (index >= galleryImages.length) index = 0;
        
        currentIndex = index;
        console.log('üñºÔ∏è Mostrando imagen:', index, galleryImages[index]);
        
        // Animaci√≥n de cambio de imagen
        mainImg.style.opacity = '0';
        
        setTimeout(() => {
            mainImg.src = galleryImages[index];
            mainImg.style.opacity = '1';
        }, 200);
        
        // Actualizar indicadores
        indicators.forEach((ind, idx) => {
            if (idx === index) {
                ind.classList.add('active');
            } else {
                ind.classList.remove('active');
            }
        });
        
        // Actualizar thumbnails
        thumbnails.forEach((thumb, idx) => {
            if (idx === index) {
                thumb.classList.add('active');
            } else {
                thumb.classList.remove('active');
            }
        });
    }

    // Bot√≥n anterior
    if (prevBtn) {
        prevBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('‚¨ÖÔ∏è Click en bot√≥n anterior');
            const newIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length;
            showImage(newIndex);
        });
        console.log('‚úÖ Event listener agregado a prevBtn');
    } else {
        console.warn('‚ö†Ô∏è prevBtn no encontrado');
    }

    // Bot√≥n siguiente
    if (nextBtn) {
        nextBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('‚û°Ô∏è Click en bot√≥n siguiente');
            const newIndex = (currentIndex + 1) % galleryImages.length;
            showImage(newIndex);
        });
        console.log('‚úÖ Event listener agregado a nextBtn');
    } else {
        console.warn('‚ö†Ô∏è nextBtn no encontrado');
    }

    // Click en thumbnails
    thumbnails.forEach(function(thumb, idx) {
        thumb.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('üñ±Ô∏è Click en thumbnail:', idx);
            showImage(idx);
        });
    });
    console.log('‚úÖ Event listeners agregados a', thumbnails.length, 'thumbnails');
    
    // Click en indicadores
    indicators.forEach(function(indicator, idx) {
        indicator.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('üéØ Click en indicador:', idx);
            showImage(idx);
        });
    });
    console.log('‚úÖ Event listeners agregados a', indicators.length, 'indicadores');

    // ===== VARIANTES MODERNAS =====
    const variantCards = document.querySelectorAll('.variant-card-modern');
    const variantIdInput = document.getElementById('variant_id');
    const mainPrice = document.getElementById('main-product-price');
    const stockDisplay = document.getElementById('available-stock');
    const quantityInput = document.querySelector('.qty-input');
    const selectedInfo = document.getElementById('selected-variant-info');
    const selectedName = document.getElementById('variant-selected-name');
    
    variantCards.forEach(function(card) {
        card.addEventListener('click', function() {
            // No permitir seleccionar agotados
            if (this.classList.contains('out-of-stock')) {
                alert('‚ùå Esta variante est√° agotada');
                return;
            }
            
            // Remover selecci√≥n previa
            variantCards.forEach(c => c.classList.remove('active'));
            
            // Marcar como seleccionada
            this.classList.add('active');
            
            // Obtener datos
            const variantId = this.dataset.variantId;
            const color = this.dataset.color;
            const price = this.dataset.price;
            const stock = this.dataset.stock;
            const imgUrl = this.dataset.img;
            
            // Actualizar input oculto
            if (variantIdInput) {
                variantIdInput.value = variantId;
            }
            
            // Actualizar imagen principal
            if (imgUrl && mainImg) {
                mainImg.style.opacity = '0';
                setTimeout(() => {
                    mainImg.src = imgUrl;
                    mainImg.style.opacity = '1';
                }, 150);
            }
            
            // Actualizar precio
            if (price && mainPrice) {
                const formattedPrice = Number(price).toLocaleString('es-CO');
                mainPrice.textContent = `$${formattedPrice}`;
            }
            
            // Actualizar stock
            if (stock && stockDisplay) {
                const stockNum = parseInt(stock);
                const parent = stockDisplay.closest('.badge-stock');
                if (parent) {
                    parent.className = 'badge-stock';
                    if (stockNum > 10) {
                        parent.classList.add('in-stock');
                    } else if (stockNum > 0) {
                        parent.classList.add('low-stock');
                    }
                }
                stockDisplay.textContent = `${stock} disponibles`;
            }
            
            // Actualizar m√°ximo de cantidad
            if (quantityInput && stock) {
                quantityInput.max = stock;
                if (parseInt(quantityInput.value) > parseInt(stock)) {
                    quantityInput.value = stock;
                }
            }
            
            // Mostrar info de selecci√≥n
            if (selectedInfo && selectedName) {
                selectedName.textContent = color || 'Variante';
                selectedInfo.style.display = 'block';
            }
            
            console.log('‚úÖ Variante seleccionada:', { variantId, color, price, stock });
        });
    });
    
    // ===== CONTROLES DE CANTIDAD MODERNOS =====
    const qtyInput = document.querySelector('.qty-input');
    const qtyDecrease = document.querySelector('.qty-decrease');
    const qtyIncrease = document.querySelector('.qty-increase');
    
    if (qtyDecrease) {
        qtyDecrease.addEventListener('click', function() {
            const currentValue = parseInt(qtyInput.value);
            const minValue = parseInt(qtyInput.min);
            if (currentValue > minValue) {
                qtyInput.value = currentValue - 1;
                this.style.transform = 'scale(0.9)';
                setTimeout(() => this.style.transform = 'scale(1)', 100);
            }
        });
    }
    
    if (qtyIncrease) {
        qtyIncrease.addEventListener('click', function() {
            const currentValue = parseInt(qtyInput.value);
            const maxValue = parseInt(qtyInput.max);
            if (currentValue < maxValue) {
                qtyInput.value = currentValue + 1;
                this.style.transform = 'scale(0.9)';
                setTimeout(() => this.style.transform = 'scale(1)', 100);
            } else {
                alert('‚ö†Ô∏è No hay m√°s stock disponible');
            }
        });
    }
    
    // Validar input manual
    if (qtyInput) {
        qtyInput.addEventListener('input', function() {
            const value = parseInt(this.value);
            const min = parseInt(this.min);
            const max = parseInt(this.max);
            
            if (value < min) this.value = min;
            if (value > max) this.value = max;
        });
    }
    
    // ===== ANIMACI√ìN AL AGREGAR AL CARRITO =====
    const addToCartBtn = document.getElementById('add_to_cart');
    if (addToCartBtn) {
        addToCartBtn.addEventListener('click', function(e) {
            const variantCards = document.querySelectorAll('.variant-card-modern');
            const variantIdInput = document.getElementById('variant_id');
            
            // Validar variante si es necesario
            if (variantCards.length > 0 && !variantIdInput.value) {
                e.preventDefault();
                alert('‚ö†Ô∏è Por favor, selecciona una variante del producto');
                return;
            }
            
            // Animaci√≥n del bot√≥n
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    }
    
    console.log('‚úÖ Sistema de producto moderno completamente inicializado');
});

// ===== WHATSAPP INTEGRATION MODERNA =====
const whatsappBtn = document.getElementById('whatsapp-chat-float');
if (whatsappBtn) {
    whatsappBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const numero = "573007915262";
        const nombre = "{{ product.name }}";
        const precio = "{{ product.price|intcomma }}";
        const mensaje = encodeURIComponent(`¬°Hola! üëã\nEstoy interesado en el producto:\nüì¶ ${nombre}\nüí∞ Precio: $${precio} COP\n\n¬øEst√° disponible?`);
        const url = `https://wa.me/${numero}?text=${mensaje}`;
        window.open(url, "_blank");
    });
}

// ===== CART FLOAT BUTTON SCROLL EFFECT =====
window.addEventListener('scroll', function() {
    const cartBtn = document.querySelector('.cart-float-modern');
    if (cartBtn) {
        if (window.scrollY > 100) {
            cartBtn.classList.add('scrolled');
        } else {
            cartBtn.classList.remove('scrolled');
        }
    }
});

// ===== CART SIDEBAR FUNCTIONALITY =====
function toggleCartSidebar() {
    const sidebar = document.getElementById('cart-sidebar-modern');
    const overlay = document.getElementById('cart-sidebar-overlay');
    
    if (sidebar && overlay) {
        const isActive = sidebar.classList.contains('active');
        
        if (isActive) {
            // Cerrar
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        } else {
            // Abrir
            sidebar.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
    }
}

// Cerrar sidebar con tecla ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const sidebar = document.getElementById('cart-sidebar-modern');
        if (sidebar && sidebar.classList.contains('active')) {
            toggleCartSidebar();
        }
    }
});

// ===== AGREGAR AL CARRITO R√ÅPIDO DESDE PRODUCTOS RELACIONADOS =====
function addToCartQuick(productId, productName) {
    console.log('üõí Agregando producto al carrito:', productId, productName);
    
    // Crear formulario din√°mico
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/add-to-cart/${productId}/`;
    
    // Agregar CSRF token
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = 'csrfmiddlewaretoken';
    csrfInput.value = csrfToken;
    form.appendChild(csrfInput);
    
    // Agregar cantidad
    const quantityInput = document.createElement('input');
    quantityInput.type = 'hidden';
    quantityInput.name = 'quantity';
    quantityInput.value = '1';
    form.appendChild(quantityInput);
    
    // Agregar al body y enviar
    document.body.appendChild(form);
    form.submit();
    
    // Mostrar notificaci√≥n visual
    showQuickNotification(`‚úÖ ${productName} agregado al carrito`);
}

function showQuickNotification(message) {
    // Crear notificaci√≥n estilo toast
    const notification = document.createElement('div');
    notification.className = 'quick-notification';
    notification.innerHTML = `
        <div class="notification-content">
            <i class="bi bi-check-circle-fill me-2"></i>
            <span>${message}</span>
        </div>
    `;
    
    // Agregar estilos inline
    notification.style.cssText = `
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        color: white;
        padding: 16px 24px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.16);
        z-index: 10000;
        animation: slideInRight 0.4s ease-out;
        font-weight: 600;
    `;
    
    document.body.appendChild(notification);
    
    // Remover despu√©s de 3 segundos
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.4s ease-out';
        setTimeout(() => notification.remove(), 400);
    }, 3000);
}

// Agregar estilos de animaci√≥n para notificaci√≥n
const notificationStyles = document.createElement('style');
notificationStyles.textContent = `
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    @keyframes slideOutRight {
        from {
            opacity: 1;
            transform: translateX(0);
        }
        to {
            opacity: 0;
            transform: translateX(100px);
        }
    }
    
    .notification-content {
        display: flex;
        align-items: center;
        font-size: 15px;
    }
`;
document.head.appendChild(notificationStyles);

// ===== BOT√ìN COMPRAR AHORA =====
const buyNowBtn = document.getElementById('buy-now-btn');
if (buyNowBtn) {
    buyNowBtn.addEventListener('click', async function(e) {
        e.preventDefault();
        
        const form = document.querySelector('form[action*="add-to-cart"]');
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const productId = '{{ product.id }}';
        const quantityInput = document.getElementById('quantity');
        const quantity = quantityInput ? quantityInput.value : 1;
        const variantSelect = document.getElementById('variant_id');
        const variantId = variantSelect ? variantSelect.value : '';
        
        // Deshabilitar bot√≥n y mostrar loading
        buyNowBtn.disabled = true;
        const originalText = buyNowBtn.querySelector('.btn-text').textContent;
        buyNowBtn.querySelector('.btn-text').textContent = 'Procesando...';
        
        try {
            // Agregar al carrito primero
            const formData = new FormData();
            formData.append('csrfmiddlewaretoken', csrfToken);
            formData.append('quantity', quantity);
            if (variantId) {
                formData.append('variant_id', variantId);
            }
            
            const response = await fetch(`/add-to-cart-detail/${productId}/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });
            
            if (response.ok) {
                // Redirigir al carrito despu√©s de agregar exitosamente
                window.location.href = '/cart';
            } else {
                throw new Error('Error al agregar al carrito');
            }
        } catch (error) {
            console.error('Error:', error);
            buyNowBtn.querySelector('.btn-text').textContent = originalText;
            buyNowBtn.disabled = false;
            alert('Error al procesar la compra. Por favor intenta nuevamente.');
        }
    });
}
    </script>
    
    <!-- Estilos para el slider de productos relacionados -->
    <style>
        /* Slider controls para product detail */
        .slider-controls-detail {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .slider-btn-detail {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 20px;
        }
        
        .slider-btn-detail:hover:not(:disabled) {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }
        
        .slider-btn-detail:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .related-slider-wrapper-detail {
            overflow: hidden;
            margin: 0 -10px;
        }
        
        .related-products-grid {
            display: flex !important;
            gap: 24px;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 8px 10px;
        }
        
        .product-card-modern {
            flex: 0 0 280px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .slider-dots-detail {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 32px;
        }
        
        .slider-dot-detail {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .slider-dot-detail.active {
            background: #667eea;
            width: 32px;
            border-radius: 5px;
        }
        
        @media (max-width: 992px) {
            .section-header-modern {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .slider-controls-detail {
                width: 100%;
                justify-content: space-between;
            }
            
            .product-card-modern {
                flex: 0 0 240px;
            }
        }
        
        @media (max-width: 768px) {
            .product-card-modern {
                flex: 0 0 220px;
            }
            
            .slider-btn-detail {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }
        
        @media (max-width: 576px) {
            .product-card-modern {
                flex: 0 0 200px;
            }
            
            .slider-controls-detail .slider-btn-detail {
                display: none;
            }
            
            .btn-view-all-modern {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
    
    <!-- Script del slider de productos relacionados -->
    <script>
        // Slider de productos relacionados en product detail
        document.addEventListener('DOMContentLoaded', function() {
            const slider = document.getElementById('detailRelatedSlider');
            const prevBtn = document.getElementById('detailSliderPrev');
            const nextBtn = document.getElementById('detailSliderNext');
            const dotsContainer = document.getElementById('detailSliderDots');
            
            if (!slider || !prevBtn || !nextBtn) return;
            
            const cards = slider.querySelectorAll('.product-card-modern');
            if (cards.length === 0) return;
            
            const cardWidth = 280 + 24; // width + gap
            let currentIndex = 0;
            
            // Calcular cu√°ntas tarjetas mostrar seg√∫n el ancho de pantalla
            function getVisibleCards() {
                const containerWidth = slider.parentElement.offsetWidth;
                const visibleCount = Math.floor(containerWidth / cardWidth);
                return Math.max(1, visibleCount);
            }
            
            // Calcular n√∫mero total de p√°ginas
            function getTotalPages() {
                const visibleCards = getVisibleCards();
                return Math.ceil(cards.length / visibleCards);
            }
            
            // Crear dots
            function createDots() {
                dotsContainer.innerHTML = '';
                const totalPages = getTotalPages();
                
                for (let i = 0; i < totalPages; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'slider-dot-detail' + (i === 0 ? ' active' : '');
                    dot.addEventListener('click', () => goToPage(i));
                    dotsContainer.appendChild(dot);
                }
            }
            
            // Actualizar posici√≥n del slider
            function updateSlider() {
                const visibleCards = getVisibleCards();
                const offset = -currentIndex * cardWidth * visibleCards;
                slider.style.transform = `translateX(${offset}px)`;
                
                // Actualizar dots
                const dots = dotsContainer.querySelectorAll('.slider-dot-detail');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentIndex);
                });
                
                // Actualizar botones
                const totalPages = getTotalPages();
                prevBtn.disabled = currentIndex === 0;
                nextBtn.disabled = currentIndex >= totalPages - 1;
            }
            
            // Ir a p√°gina espec√≠fica
            function goToPage(page) {
                const totalPages = getTotalPages();
                if (page < 0 || page >= totalPages) return;
                currentIndex = page;
                updateSlider();
            }
            
            // Event listeners
            prevBtn.addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateSlider();
                }
            });
            
            nextBtn.addEventListener('click', () => {
                const totalPages = getTotalPages();
                if (currentIndex < totalPages - 1) {
                    currentIndex++;
                    updateSlider();
                }
            });
            
            // Inicializar
            createDots();
            updateSlider();
            
            // Actualizar en resize
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    currentIndex = 0;
                    createDots();
                    updateSlider();
                }, 250);
            });
            
            // Touch/swipe support para m√≥vil
            let touchStartX = 0;
            let touchEndX = 0;
            
            slider.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            slider.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                if (touchStartX - touchEndX > swipeThreshold) {
                    // Swipe left (next)
                    nextBtn.click();
                } else if (touchEndX - touchStartX > swipeThreshold) {
                    // Swipe right (prev)
                    prevBtn.click();
                }
            }
        });
    </script>
    
</body>
</html>