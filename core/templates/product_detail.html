{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tienda Online</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/detail.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>
    <a href="#" id="whatsapp-chat-float" class="whatsapp-float" title="Chatea por WhatsApp" target="_blank">
         <img src="{% static 'img/whatsapp-icon.png' %}" alt="WhatsApp" style="width:60px; height:60px; border-radius:50%;">
    </a>
    <header>
        {% include 'navbarr.html' %}
    </header>
    <main>
        <div class="container-product-all mt-5">
            <div class="container_product">
                <!-- Carrito flotante -->
                <div class="car-buy">
                    <!-- ...existing code... -->
                    <a href="/cart" type="button" class="cart-toggle-btn btn-cart position-relative">
                        <i class="bi bi-cart-plus-fill fs-1"></i>
                        <span class="position-absolute top-45 start-80 translate-middle badge rounded-pill bg-danger">
                            {{ cart_count }}
                            <span class="visually-hidden">unread messages</span>
                        </span>
                    </a>
                </div>
                <div class="product-Galery">
                    <!-- Imagen principal y galer√≠a -->
                    <div class="product-image">
                        <h1>{{ product.name }}</h1>
                        <div class="image-slider" style="position: relative; display: flex; align-items: center;  width: 100%; height: 400px; overflow: hidden;">
                            <button id="prev-img" class="slider-arrow" style="position: absolute; left: 0; z-index: 2; background: none; border: none; font-size: 2rem; cursor: pointer;">&#8592;</button>
                            <img id="main-product-image"
                                 src="{% if Galeria_images %}{{ Galeria_images.0.galeria.url }}{% else %}{{ product.imagen.url }}{% endif %}"
                                 alt="{{ product.name }}"
                                 style="max-width: 100%; max-height: 400px; margin: 0 auto; display: block;">
                            <button id="next-img" class="slider-arrow" style="position: absolute; right: 0; z-index: 2; background: none; border: none; font-size: 2rem; cursor: pointer;">&#8594;</button>
                        </div>
                          <!-- Caracter√≠sticas del producto -->
                        <div class="product-details">
                            <div class="cart-left">
                                <h2>Caracter√≠sticas del Producto</h2>
                                Producto: <span class="text-success">{{ product.name }}</span><br>
                                description: <span class="text-success">{{ product.description }}</span><br>
                              
                            </div>
                        </div>

  <!-- Rese√±as de clientes -->
                <div class="product-reviews">
                    <h2>Rese√±as de Clientes</h2>
                    <div class="review">
                        <p><strong>Juan P√©rez</strong> - ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</p>
                        <p>Excelente producto, muy satisfecho con la compra.</p>
                    </div>
                    <div class="review">
                        <p><strong>Mar√≠a G√≥mez</strong> - ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</p>
                        <p>Buena calidad, pero el env√≠o tard√≥ un poco m√°s de lo esperado.</p>
                    </div>
                    <div class="review">
                        <p><strong>Carlos Rodr√≠guez</strong> - ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</p>
                        <p>El producto es aceptable, pero esperaba m√°s por el precio.</p>
                    </div>
                </div>

                        <div class="Gallery mt-3">
                            {% for imagen in Galeria_images %}
                                <img src="{{ imagen.galeria.url }}" alt="Thumbnail" class="thumbnail">
                            {% endfor %}
                        </div>
                      
                    </div>
                    <!-- Informaci√≥n y acciones de compra -->
                    <div class="product-info">
                        <div class="description-section">
                            <h1>Descripci√≥n del producto</h1>
                            <p class="description">{{ product.description|truncatechars:100|safe }}</p>
                        </div>
                        <div class="price">
                            <span id="main-product-price" class="amount">${{ product.price|intcomma }} COP</span>
                            <span class="price-discount">Antes: ${{ product.price|add:"30000"|intcomma }} COP</span>
                        </div>
                       <div class="car">
    <span class="ui-pdp-buybox__quantity__selected" id="available-stock">Disponibles {{ product.stock }}</span>
    <form class="btn for-variant" method="post" action="{% url 'add_to_cart_detail' product.id %}">
        {% csrf_token %}
        {# Selector de variantes #}
        {% if product.variants.all %}
           
            {% if product.variants.all %}
    <label><strong>Elige un color:</strong></label>
    <div id="variant-swatches" class="variant-swatches" style="display: flex; gap: 12px; margin-bottom: 16px;">
        {% for variant in product.variants.all %}
            <button type="button" class="variant-swatch" data-variant-id="{{ variant.id }}"
                   {% if variant.imagen %}
                    data-img="{{ variant.imagen.url }}"
                    {% else %}
                    data-img=""
                   {% endif %}
                    data-precio="{{ variant.precio }}"
                    data-stock="{{ variant.stock }}"
                    style="border: 2px solid #ccc;  background: none; padding: 2px; border-radius: 10%; cursor: pointer;">
                {% if variant.imagen %}
                    <img src="{{ variant.imagen.url }}" alt="{{ variant.color }}" title="{{ variant.color }}"
                         style="width: 106px; height: 106px; display: block; border-radius: 10%; border: 2px solid #eee;">
                        <div class="info-variant" style="text-align:left; font-size:12px; margin-top:5px;">                           
                           <div>Color:{{ variant.color }}</div>
                           <div>Stock:{{ variant.stock }}</div>
                           
                        </div>

                {% else %}
                    <span style="display:inline-block;width:36px;height:36px;border-radius:50%;background:{{ variant.color|default:'#ccc' }}"></span>
                {% endif %}
            </button>
        {% endfor %}
    </div>
    <input type="hidden" name="variant_id" id="variant_id" required>
     {% endif %}
            <br>
            <img id="variant-image" src="" alt="Imagen variante" style="max-width: 180px; margin: 10px 0; display: none;">
        {% endif %}
        {% if product.stock == 0 %}
        <span class="agotado" style="color:black;font-weight:bold;">Agotado</span>
       {% else %}
       
        <input type="number" name="quantity" min="1" value="1" max="{{ product.stock }}" class="quantity-input">        
        <button type="submit" id="add_to_cart" class="btn2">üõí</button>
         
      
      </div>
                       <button type="submit" id="go_to_cart" name="go_to_cart" class="btn1">PEDIR AHORA</button>
                     {% endif %}   
                    </form>
                        <div class="cart-right-polices">
                            <h2>Pol√≠ticas de Compra</h2>
                            <ul>
                                <li><strong>Env√≠o:</strong> Env√≠o gratuito en compras superiores a $200,000 COP. Tiempo de entrega estimado: 3-5 d√≠as h√°biles.</li>
                                <li><strong>Devoluciones:</strong> Aceptamos devoluciones dentro de los 30 d√≠as posteriores a la compra. El producto debe estar en su estado original.</li>
                                <li><strong>Garant√≠a:</strong> Todos nuestros productos cuentan con una garant√≠a de 3 meses contra defectos de fabricaci√≥n.</li>
                                <li><strong>Soporte:</strong> Nuestro equipo de soporte est√° disponible para ayudarte con cualquier consulta o problema relacionado con tu compra.</li>
                            </ul>
                        </div>
                    </div>
                </div>
              
            </div>
            <!-- Publicidad o im√°genes adicionales -->
            <div class="cart-all-img">
                <div class="img-publicity">
                    <img src="{{ product.imagen.url }}" alt="Publicidad" style="width:100%; height:100%;">
                </div >
                {% for imagen in Galeria_images %}
                    <div class="img-publicity mt-4">
                        <img src="{{ imagen.galeria.url }}" alt="Publicidad" style="width:100%; height:100%; margin-bottom:50px;">
                    </div>
                {% endfor %}
            </div>
             
        </div>
    </main>
    <footer>
        {% include 'footer.html' %}
    </footer>
   
   
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/detail_product.js' %}"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
    // Galer√≠a de im√°genes
    const galleryImages = [
        {% for imagen in Galeria_images %}
            "{{ imagen.galeria.url }}",
        {% endfor %}
    ];
    {% if not Galeria_images %}
        galleryImages.push("{{ product.imagen.url }}");
    {% endif %}

    let currentIndex = 0;
    const mainImg = document.getElementById('main-product-image');
    const prevBtn = document.getElementById('prev-img');
    const nextBtn = document.getElementById('next-img');

    function showImage(index) {
        if (galleryImages.length === 0) return;
        mainImg.src = galleryImages[index];
    }

    prevBtn.addEventListener('click', function() {
        currentIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length;
        showImage(currentIndex);
    });

    nextBtn.addEventListener('click', function() {
        currentIndex = (currentIndex + 1) % galleryImages.length;
        showImage(currentIndex);
    });

    // Cambia la imagen principal al hacer clic en una miniatura
    document.querySelectorAll('.thumbnail').forEach(function(thumb, idx) {
        thumb.addEventListener('click', function() {
            currentIndex = idx;
            showImage(currentIndex);
        });
    });

    // --- Swatches de variantes ---
    document.querySelectorAll('.variant-swatch').forEach(function(btn) {
        btn.addEventListener('click', function() {
            // Quitar selecci√≥n previa
            document.querySelectorAll('.variant-swatch').forEach(function(b) {
                b.style.border = "2px solid #ccc";
            });
            // Marcar seleccionada
            btn.style.border = "2px solid #405cdb";
            // Actualizar input oculto
            document.getElementById('variant_id').value = btn.getAttribute('data-variant-id');
            // Cambiar imagen principal
            var imgUrl = btn.getAttribute('data-img');
            if (imgUrl) {
                mainImg.src = imgUrl;
            } else {
                mainImg.src = "{{ product.imagen.url }}";
            }
            // Cambiar precio
            var precio = btn.getAttribute('data-precio');
            var mainPrice = document.getElementById('main-product-price');
            if (precio) {
                mainPrice.textContent = "$" + Number(precio).toLocaleString('es-CO') + " COP";
            } else {
                mainPrice.textContent = "${{ product.price|intcomma }} COP";
            }
            // Actualizar stock disponible
            var stock = btn.getAttribute('data-stock');
            var stockDisplay = document.getElementById('available-stock');
            if (stockDisplay) {
                stockDisplay.textContent = "Disponibles " + (stock || 0);
            }
            // Actualizar cantidad m√°xima
            var quantityInput = document.querySelector('.quantity-input');
            if (quantityInput) {
                quantityInput.max = stock || 0;
            }
        });
    });
});





document.getElementById('whatsapp-chat-float').addEventListener('click', function(e) {
    e.preventDefault();
    var numero = "573007915262"; // Cambia por tu n√∫mero real
    var nombre = "{{ product.name }}";
   
    var mensaje = "Hola, quiero m√°s informaci√≥n sobre el producto: " + nombre ;
    var url = "https://wa.me/" + numero + "?text=" + mensaje;
    window.open(url, "_blank");
});

document.addEventListener('DOMContentLoaded', function () {
  const cart = document.querySelector('.cart-sidebar, #cart, .cart-widget');
  const toggleBtn = document.querySelector('.cart-toggle-btn, .open-cart-btn, .btn-cart');
  if (!cart || !toggleBtn) return;

  toggleBtn.addEventListener('click', function (e) {
    e.preventDefault();
    // si es sidebar deslizable usa clase .open, si es bloque flotante togglea display
    if (cart.classList.contains('cart-sidebar')) {
      cart.classList.toggle('open');
    } else {
      cart.style.display = (cart.style.display === 'block' ? 'none' : 'block');
    }
  });

  // cerrar al tocar fuera (m√≥vil)
  document.addEventListener('click', function (e) {
    if (!cart.contains(e.target) && !toggleBtn.contains(e.target)) {
      if (cart.classList.contains('open')) cart.classList.remove('open');
    }
  });
});
    </script>
</body>
</html>