<!-- filepath: d:\ESCRITORIO\CompueasysApp\dashboard\templates\dashboard\dashboard_home.html -->
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <title>Dashboard Tienda</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

</head>
<body>
    <header>
       <div class="admin-container">
         <h1>Tienda CompuEasys</h1>
          <div class="logout-container">
            <form method="post" action="{% url 'logout_view' %}">
                {% csrf_token %}
                <button type="submit" class="btn ">Cerrar sesión</button>
            </form>
          </div>
       </div>
    </header>
    <div class="dashboard-container">
        <aside class="sidebar">
            <ul>
                <li><a href="?view=usuarios">Usuarios</a></li>
                <li><a href="?view=productos">Productos</a></li>
                <li><a href="?view=pedidos">Pedidos</a></li>
                <li><a href="?view=categoria">Categorías</a></li>
                <li><a href="?view=inventario">Inventario</a></li>
                <li><a href="?view=proveedores">Proveedores</a></li>
            </ul>
        </aside>
        <main class="main-content">
            {% if request.GET.view == "usuarios" %}
                <h2>Usuarios</h2>
                 <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}"> 
                <table>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Staff</th>
                        <th>Super</th>
                        <th>Activo</th>
                        <th>Admin</th>
                        <th>Acciones</th>
                    </tr>
                    {% for usuario in usuarios %}
                    <tr>
                        <td>{{ usuario.username }}</td>
                        <td>{{ usuario.email }}</td>
                        <td>
                            <select name="is_staff">
                                <option value="True">Sí</option>
                                <option value="False">No</option>
                            </select>
                        </td>
                        <td>
                            <select name="is_superuser">
                                <option value="True">Sí</option>
                                <option value="False">No</option>
                            </select>
                        </td>
                        <td>
                            <select name="is_active">
                                <option value="True">Sí</option>
                                <option value="False">No</option>
                            </select>
                        </td>
                        <td>
                            <select name="is_admin">
                                <option value="True">Sí</option>
                                <option value="False">No</option>
                            </select>
                        </td>                    
                            
                            <td>
                                <button onclick="openEditModal('{{ usuario.id }}', '{{ usuario.username }}', '{{ usuario.email }}')">Editar</button>
                                <button class="btn btn-danger eliminar-usuario-btn" data-user-id="{{ usuario.id }}">Eliminar</button>
                           </td>
                            {% if usuario.is_staff %}
                                <span>Admin</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    {% for usuario in usuarios_super %}
                    <tr>
                        <td>{{ usuario.username }}</td>
                        <td>{{ usuario.email }}</td>
                        <td>
                            <select name="is_staff">
                                <option value="True">Sí</option>
                                <option value="False">No</option>
                            </select>
                        </td>
                        <td>
                            <select name="is_superuser">
                                <option value="True">Sí</option>
                                <option value="False">No</option>
                            </select>
                        </td>
                        <td>
                            <select name="is_active">
                                <option value="True">Sí</option>
                                <option value="False">No</option>
                            </select>
                        </td>
                        <td>
                            <select name="is_admin">
                                <option value="True">Sí</option>
                                <option value="False">No</option>
                            </select>
                        </td>
                        <td>
                            <td>
                                <button onclick="openEditModal('{{ usuario.id }}', '{{ usuario.username }}', '{{ usuario.email }}')">Editar</button>
                            <td>
                                <button class="btn btn-danger eliminar-usuario-btn" data-user-id="{{ usuario.id }}">Eliminar</button>
                            </td>
                            {% if usuario.is_staff %}
                                <span>Admin</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            {% elif request.GET.view == "productos" %}
                <h2>Productos</h2>
                <a href="?view=productos&crear=1" class="btn-crear-producto">Crear producto</a>
                <table>
                    <tr>
                        <th>Nombre</th>
                        <th>Stock</th>
                        <th>Precio</th>
                    </tr>
                    {% for producto in productos %}
                    <tr>
                        <td><img src="{{ producto.imagen.url }}" alt="{{ producto.name }}" width="50" height="50"/></td>
                        <td>{{ producto.name }}</td>
                        <td>{{ producto.stock }}</td>
                        <td>${{ producto.price }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% if show_create_product_form %}
                <h2>Crear Producto</h2>
                <form method="post" enctype="multipart/form-data" class="form-crear-producto">
                    {% csrf_token %}
                    <label>Nombre:</label>
                    <input type="text" name="name" required />
                    <label>Descripción:</label>
                    <textarea name="description"></textarea>
                    <div class="precios">
                        <div>
                            <label>Precio de compra:</label>
                            <input type="number" name="price_buy" step="0.01" required />
                        </div>
                        <div>
                            <label>Precio de venta:</label>
                            <input type="number" name="price" step="0.01" required />
                        </div>
                        <div>
                            <label>Stock:</label>
                            <input type="number" name="stock" required />
                        </div>
                        <div>
                            <label>Descuento:</label>
                            <input type="number" name="descuento" step="0.01" />
                        </div>
                        <div>
                            <label>IVA:</label>
                            <input type="number" name="iva" step="0.01" />
                        </div>
                    </div>
                    <div class="categorias-proveedor">
                        <div>
                            <label>Proveedor:</label>
                            <select name="proveedor" class="form-select">                               
                                <option value="">Seleccione un proveedor</option>
                                {% for prov in proveedores %}
                                    <option value="{{ prov.id }}">{{ prov.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label>Categorías:</label>
                            <select name="categoria" class="form-select">
                               <option value="">Seleccione una categoría</option>
                                {% for categoria in categorias %}
                                    <option value="{{ categoria.id }}">{{ categoria.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label>Tipo de producto:</label>
                            <select name="type" class="form-select">
                                <option value="">Seleccione un tipo</option>
                                {% for tipo in tipos %}
                                    <option value="{{ tipo.id }}">{{ tipo.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <label>Imagen principal:</label>
                    <input type="file" name="images" />
                    <label>Galería:</label>
                    <input type="file" name="galeria" multiple />
                    <label>Variantes:</label>
                    <div id="variantes-container">
                        <div class="variante-row">                            
                            <input type="text" name="variante_nombre[]" placeholder="Nombre variante" />
                            <input type="number" name="variante_precio[]" placeholder="Precio" step="0.01" />
                            <input type="number" name="variante_stock[]" placeholder="Stock" />
                            <input type="text" name="variante_color[]" placeholder="Color" />
                            <input type="text" name="variante_talla[]" placeholder="Talla" />
                            <input type="file" name="variante_imagen[]" />  
                        </div>
                    </div>
                    <button type="button" onclick="agregarVariante()">Agregar otra variante</button>
                    <button type="submit">Guardar</button>
                </form>
                {% endif %}
            {% elif request.GET.view == "pedidos" %}
                <h2>Pedidos</h2>
                <table>
                    <tr>
                        <th>ID</th>
                        <th>Usuario</th>
                        <th>Total</th>
                        <th>Fecha</th>
                    </tr>
                    {% for pedido in pedidos %}
                    <tr>
                        <td>{{ pedido.id }}</td>
                        <td>{{ pedido.user }}</td>
                        <td>${{ pedido.total }}</td>
                        <td>{{ pedido.created_at }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% elif request.GET.view == "inventario" %}
                <h2>Inventario</h2>
                <p>Aquí puedes mostrar tu inventario...</p>
            {% elif request.GET.view == "categoria" %}
                <h2>Categorías</h2>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalNuevaCategoria">
                    Nueva Categoría
                </button>
                 
                <table>
                    <tr>
                        <th>Nombre</th>
                        <th>Acciones</th>
                       
                    </tr>
                    {% for categoria in categorias %}
                    <tr>
                       
                        <td>{{ categoria.nombre }}</td>
                        <td>
                            <a href="{% url 'editar_categoria' categoria.id %}" class="btn btn-sm btn-warning">Editar</a>
                            <a href="{% url 'delete_category' categoria.id %}" class="btn btn-sm btn-danger">Eliminar</a>
                        </td>
                    </tr>
                    {% endfor %}
                </table> 
              
            {% elif request.GET.view == "proveedores" %}
                <h2>Proveedores</h2>
                {% if proveedores %}
                    <ul>
                        {% for proveedor in proveedores %}
                            <li>{{ proveedor.nombre }} - {{ proveedor.telefono }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No hay proveedores disponibles.</p>
                {% endif %}
            {% else %}
                <h2>Bienvenido al Dashboard</h2>
                <p>Selecciona una opción en la barra lateral.</p>
            {% endif %}
        </main>
    </div>
    <!-- Modal para nueva categoría -->
     <!-- Modal para crear nueva categoría -->
<div class="modal fade" id="modalNuevaCategoria" tabindex="-1" aria-labelledby="modalNuevaCategoriaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'crear_categoria' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="modalNuevaCategoriaLabel">Crear nueva categoría</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <label for="nombre_categoria">Nombre de la categoría:</label>
          <input type="text" class="form-control" id="nombre_categoria" name="nombre" required>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>
    <!-- Modal para editar usuario -->
    <div id="editModal" class="modal1">
        <div class="modal-content1">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h3>Editar Usuario</h3>
            <form id="editForm" method="post">
                {% csrf_token %}
                <input type="hidden" name="user_id" id="modal_user_id" />
                <label>Username:</label>
                <input type="text" name="username" id="modal_username" required />
                <label>Email:</label>
                <input type="email" name="email" id="modal_email" required />
                <label>Contraseña (dejar en blanco para no cambiar):</label>
                <input type="password" name="password" id="modal_password" />
                <label>Celular:</label>
                <input type="text" name="celular" id="modal_celular" />
                <label>Dirección:</label>
                <input type="text" name="direccion" id="modal_direccion" />
                <label>Ciudad:</label>
                <input type="text" name="ciudad" id="modal_ciudad" />
                <label>País:</label>
                <input type="text" name="pais" id="modal_pais" />
                <label>Código postal:</label>
                <input type="text" name="codigo_postal" id="modal_codigo_postal" />
                <label>Fecha de creación:</label>
                <input type="date" name="created_at" id="modal_created_at" />
                <label>Fecha de nacimiento:</label>
                <input type="date" name="fecha_nacimiento" id="modal_fecha_nacimiento" />
                <label>Género:</label>
                <input type="text" name="genero" id="modal_genero" />
                <button type="submit">Guardar</button>
            </form>
        </div>
    </div>
    <script src="{% static 'js/dashboard.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    
</body>
</html>